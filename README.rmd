---
title: rotl README
output:
  md_document:
    variant: markdown_github
---


```{r setup, eval=TRUE, echo=FALSE}
library(knitr)
opts_knit$set(upload.fun = image_uri)

```

[![Build Status](https://travis-ci.org/fmichonneau/rotl.svg)](https://travis-ci.org/fmichonneau/rotl.svg)

# An R interface to Open Tree API

This is the bleedingly-Alpha developmental version of an R package wrapping the
Open Tree of Life data APIs, which being developed as part of the
[NESCENT/OpenTree/Arbor
hackathon](http://blog.opentreeoflife.org/2014/06/11/apply-for-tree-for-all-a-hackathon-to-access-opentree-resources/).

Check out the sister repos for
[Python](https://github.com/OpenTreeOfLife/opentree-interfaces/tree/master/python)
and [Ruby](https://github.com/SpeciesFileGroup/bark). 

##Installation

If you want to play with these functions you can, via
[devtools](https://github.com/hadley/devtools).

```{r, eval=FALSE)
library(devtools)

install_github("fmichonneau/rotl")
```

##Simple examples

Note: the library is still in active development and behaviour of the following
functions may well change in the future:

### Get a little bit of the big Open Tree tree

First find ott ids for a set of names:

```{r resolve}
apes <- c("Pan", "Pongo", "Pan", "Gorilla", "Hylobates", "Hoolock", "Homo")
(resolved_names <- tnrs_match_names(apes))
```
Now get open tree to return a tree with just those tips. 

NOTE: the code below uses a work-around that avoids a (temporary) time-consuming step that cleans source trees for parsing safely in R. In the future `tol_induced_subtree()` will return a tree object

```{r get_tr}
response <- .tol_induced_subtree(ott_ids=as.numeric(resolved_names$ott_id))
tr <- read.tree(text=response$subtree)
plot(tr)
```


### Find trees focused on my favourite taxa

```{r mammals}
furry_studies <- studies_find_studies(property="ot:focalCladeOTTTaxonName", value="Mammalia")
( furry_ids <- unlist(furry_studies$matched_studies) )

```

### Get a specific study tree
```{r tree}
library(ape)
furry_metadata <- httr::content(get_study_meta(2647))
furry_metadata$nexml$treesById
tr_string <- get_study_tree(study="2647", tree="tree6169",format="newick")
plot(read.tree(text=tr_string))
```
